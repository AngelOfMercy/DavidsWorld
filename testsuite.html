<html>
  <head>
    <title></title>
    <meta content="">
    <script type="text/javascript" src="js/jquery-1.11.3.js"></script>
    <script type="text/javascript" src="evaluation.js"></script>
    <style></style>
  </head>
  <body>


  </body>
<script type="text/javascript">
function performTest(message, expr, expected, scope, succ) {
	var eval = evaluate(expr, scope);
	$('body').append($('<div/>', {'class':'result'}).text(message + ': ' + (((eval === expected) === succ) ? 'passed' : 'failed') ) );
}

var expression = {
	type:"SOME",
	first: 'p',
	second: {
		type: 'EQUAL',
		first: {type: 'CONST', val: 7},
		second: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}
	}
};

var world = [{x: 3, y: 2},
			 {x: 5, y: 2},
			 {x: 8, y: 4},
			 {x: 1, y: 3}
			];

performTest('Test 1', expression, false, {}, true);

//Test field access
performTest('Test 2', {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, 1, { p: {x: 1, y: 2}}, true);
performTest('Test 3', {type: 'VAR_ACCESS', vari: 'q', field: 'x'}, 3, { p: {x: 1, y: 2}, q: {x: 3, y: 2}}, true);

//Const
performTest('Test 4', {type: 'CONST', val: 4}, 4, {}, true);
performTest('Test 5', {type: 'CONST', val: 4}, '4', {}, false);

//Implies
performTest('Test 6', {type: 'IMPLIES', first: {type: 'CONST', val: true}, second: {type: 'CONST', val: false}}, false, {}, true);
performTest('Test 7', {type: 'IMPLIES', first: {type: 'CONST', val: false}, second: {type: 'CONST', val: false}}, true, {}, true);
//More tests
//{type: , first: , second: }

//Some p . p.x = 3 and p.y = 2 (should be true)
performTest('Test 8', {type: 'SOME', first: 'p', second: {type: 'AND', first: {type: 'EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'CONST', val: 3}},
 second: {type: 'EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'CONST', val: 2}}}}, true, {}, true);

//All p . p.x < 10 or p.y > 3 (should be true)
performTest('Test 9', {type: 'ALL', first: 'p', second: {type: 'OR', first: {type: 'LESS_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'CONST', val: 10}},
 second: {type: 'GREATER_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'CONST', val: 3}}}}, true, {}, true);

//All p . p.x < 10 and p.y > 3 (should be false)
performTest('Test 10', {type: 'ALL', first: 'p', second: {type: 'AND', first: {type: 'LESS_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'CONST', val: 10}},
 second: {type: 'GREATER_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'CONST', val: 3}}}}, true, {}, false);

//All p . p.x != p.y (should be true)
performTest('Test 11', {type: 'ALL', first: 'p', second: {type: 'NOT_EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}}}, true, {}, true);

//Some p . p.x == p.y (should be false)
performTest('Test 12', {type: 'SOME', first: 'p', second: {type: 'EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}}}, true, {}, false);

//Some p, q . p.x == q.y (should be true)
performTest('Test 13', {type: 'SOME', first: 'p', second: {type: 'SOME', first: 'q', second: {type: 'EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'VAR_ACCESS', vari: 'q', field: 'y'}}}}, true, {}, true);

//All p, q . p != q -> p.y != q.y (should be false)
performTest('Test 14', {type: 'ALL', first: 'p', second: {type: 'ALL', first: 'q', second:
{type: 'IMPLIES', first: {type: 'NOT_EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: null}, second: {type: 'VAR_ACCESS', vari: 'q', field: null}}, 
second: {type: 'NOT_EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'VAR_ACCESS', vari: 'q', field: 'y'}}}}}, true, {}, false);

//Some p, q . p = q (should be true)
performTest('Test 15', {type: 'SOME', first: 'p', second: {type: 'SOME', first: 'q', second: {type: 'NOT_EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: null}, second: {type: 'VAR_ACCESS', vari: 'q', field: null}}}}, true, {}, true);


//All p . p.x > 6 iff p.y > 2 (should be false)
performTest('Test 16', {type: 'ALL', first: 'p', second: {type: 'IFF', first: {type: 'GREATER_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'CONST', val: 6}},
 second: {type: 'GREATER_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'CONST', val: 2}}}}, true, {}, false);

//Some p . p.x > 6 iff p.y > 2 (should be true)
performTest('Test 17', {type: 'SOME', first: 'p', second: {type: 'IFF', first: {type: 'GREATER_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'CONST', val: 6}},
 second: {type: 'GREATER_THAN', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'CONST', val: 2}}}}, true, {}, true);

//Some p . p.x == 8 and (All q . p.y >= q.y) (should be true)
performTest('Test 18', {type: 'SOME', first: 'p', second: {type: 'AND', first: {type: 'EQUAL', first: {type: 'VAR_ACCESS', vari: 'p', field: 'x'}, second: {type: 'CONST', val: 8}},
 second: {type: 'ALL', first: 'q', second: {type: 'GTE', first: {type: 'VAR_ACCESS', vari: 'p', field: 'y'}, second: {type: 'VAR_ACCESS', vari: 'q', field: 'y'} } }}}, true, {}, true);


</script>
</html>